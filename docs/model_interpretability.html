---

title: Model Interpretability


keywords: fastai
sidebar: home_sidebar

summary: "Recipes for Model Interpretability"
description: "Recipes for Model Interpretability"
nb_path: "nbs/04_model_validation/model_interpretability.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04_model_validation/model_interpretability.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="GLM,-GAM">GLM, GAM<a class="anchor-link" href="#GLM,-GAM"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Linear-Regression">Linear Regression<a class="anchor-link" href="#Linear-Regression"> </a></h3><h4 id="Assumptions">Assumptions<a class="anchor-link" href="#Assumptions"> </a></h4><ol>
<li>Target $y$ and features $X$ have a linear relationship (else not modelable)</li>
<li>No correlation between features in $X$ (else coefficients have numerical instability)</li>
<li>Residuals are normally distributed</li>
<li>Trendline is homoscedastic -- variance is the same everywhere on the line</li>
</ol>
<h4 id="Interpretation">Interpretation<a class="anchor-link" href="#Interpretation"> </a></h4><ul>
<li>Product of coefficient and feature value $c_1x_1$ is the marginal contribution of $x_1$ in terms of $y$</li>
<li>Sum up products to get the estimated value for target $y = \sum{c_ix_i}_{i=0}^n$</li>
<li>Interaction terms $x_ix_j$ allow for two variables to have a non-additive effect on the target</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Logistic-Regression">Logistic Regression<a class="anchor-link" href="#Logistic-Regression"> </a></h3><h4 id="Assumptions">Assumptions<a class="anchor-link" href="#Assumptions"> </a></h4><ol>
<li>Target $y$ and log-odds of features $X$ have a linear relationship</li>
<li>No correlation between features in $X$</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="GLM-like-models">GLM-like models<a class="anchor-link" href="#GLM-like-models"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Decision-Trees">Decision Trees<a class="anchor-link" href="#Decision-Trees"> </a></h3><ul>
<li>Read the tree</li>
<li>Single tree prone to overfitting; do not use</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tree-Ensemble-Models">Tree Ensemble Models<a class="anchor-link" href="#Tree-Ensemble-Models"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Tree-Rules">Tree Rules<a class="anchor-link" href="#Tree-Rules"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SHAP">SHAP<a class="anchor-link" href="#SHAP"> </a></h3><ul>
<li>Maybe better to use </li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">xgboost</span>
<span class="kn">import</span> <span class="nn">shap</span>
<span class="n">shap</span><span class="o">.</span><span class="n">initjs</span><span class="p">()</span>

<span class="c1"># train an XGBoost model</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">boston</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">xgboost</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># explain the model&#39;s predictions using SHAP</span>
<span class="c1"># (same syntax works for LightGBM, CatBoost, scikit-learn, transformers, Spark, etc.)</span>
<span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">Explainer</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">shap_values</span> <span class="o">=</span> <span class="n">explainer</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># visualize the first prediction&#39;s explanation</span>
<span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">waterfall</span><span class="p">(</span><span class="n">shap_values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Deep-Learning-Models">Deep Learning Models<a class="anchor-link" href="#Deep-Learning-Models"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Grad-CAM">Grad-CAM<a class="anchor-link" href="#Grad-CAM"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model-Agnostic-Methods">Model-Agnostic Methods<a class="anchor-link" href="#Model-Agnostic-Methods"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SHAP">SHAP<a class="anchor-link" href="#SHAP"> </a></h3><ul>
<li>Maybe better to use <a href="https://github.com/ModelOriented/DALEX">DALEX</a>, which includes a SHAP implementation.  It is better maintained at this point than the <a href="https://github.com/slundberg/shap">original SHAP from slundberg</a> (over 1k issues open)</li>
<li>Uses a game theory to attribute predictions to features in a model</li>
<li>Seems to be used extensively now, but some debate on soundness:<ul>
<li><a href="https://arxiv.org/pdf/2002.11097.pdf">https://arxiv.org/pdf/2002.11097.pdf</a></li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Deep-Learning-Models-(TensorFlow/PyTorch)">Deep Learning Models (TensorFlow/PyTorch)<a class="anchor-link" href="#Deep-Learning-Models-(TensorFlow/PyTorch)"> </a></h3><h4 id="DeepExplainer">DeepExplainer<a class="anchor-link" href="#DeepExplainer"> </a></h4><h4 id="GradientExplainer">GradientExplainer<a class="anchor-link" href="#GradientExplainer"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Interaction-Values">Interaction Values<a class="anchor-link" href="#Interaction-Values"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Grad-CAM">Grad CAM<a class="anchor-link" href="#Grad-CAM"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Causal-Inference-Models">Causal Inference Models<a class="anchor-link" href="#Causal-Inference-Models"> </a></h2>
</div>
</div>
</div>
</div>
 

